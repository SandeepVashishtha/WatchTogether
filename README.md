## WatchTogether — YouTube Watch Party with Video/Audio Chat

Collaborative watch parties with synced YouTube playback, real‑time video/audio chat, and host controls. Frontend in React, backend in Spring Boot, WebRTC for P2P media, and YouTube IFrame Player API for playback.

---

## 1. Introduction

### 1.1 Purpose
Enable multiple users to join a virtual room, watch a synchronized YouTube video, and communicate via real‑time video and audio chat. The host controls playback (play, pause, seek, skip) and all participants see the video in sync.

### 1.2 Scope
- Create/join rooms using a room ID or invite link
- Synchronized YouTube playback across all participants
- Real‑time video/audio via WebRTC (peer‑to‑peer)
- Spring Boot backend for signaling, rooms, and sync events
- Optional authentication (JWT/Firebase)

---

## 2. Functional Requirements

### 2.1 User Roles
- Host:
	- Creates a room, selects YouTube video
	- Controls playback (play, pause, skip, seek)
- Participant:
	- Joins via room ID/link
	- Views synchronized video
	- Can toggle camera/microphone

### 2.2 Features
- Room Management
	- Host creates room (unique ID generated by backend)
	- Participants join via room ID/invite
- YouTube Playback Sync
	- Host loads video by YouTube ID
	- Host actions (play, pause, seek, skip) broadcast to all participants
	- Clients update instantly for near real‑time sync
- Real‑Time Communication
	- WebRTC establishes P2P A/V connections
	- Spring Boot acts as signaling server (SDP offers/answers, ICE candidates)
- Messaging (Optional)
	- In‑room text chat via WebSocket
- Security
	- Access controlled by room ID/token
	- Optional JWT auth

---

## 3. Non‑Functional Requirements
- Performance: video sync delay ≤ 500 ms across participants
- Capacity: support 5–6 users per room via P2P; use an SFU (Jitsi/Janus/mediasoup) for larger groups
- Scalability: backend supports multiple concurrent rooms
- Usability: simple UI for camera, mic, and YouTube playback controls
- Security: encrypted signaling (WSS), WebRTC DTLS‑SRTP

---

## 4. System Architecture

### 4.1 Components
- Frontend (React)
	- YouTube IFrame Player API
	- WebRTC for audio/video
	- WebSocket client (STOMP/SockJS)
- Backend (Spring Boot)
	- WebSocket server (STOMP over SockJS)
	- REST API for room creation/joining
	- Broadcasts YouTube sync events
	- Relays WebRTC signaling messages
- Database (Optional)
	- Room data (room ID, host, participants)
	- User auth info

### 4.2 Data Flow
1) Host creates a room → Backend generates room ID
2) Participants join → Backend adds them to the room context
3) Host playback action → Frontend sends event → Backend broadcasts → Clients sync player state
4) A/V enable → WebRTC offer via backend → Peers respond → P2P media path established
5) Media flows peer‑to‑peer (not through backend)

### 4.3 Mermaid Diagram
```mermaid
flowchart LR
	subgraph Client[React Frontend]
		YT[YouTube IFrame Player]
		RTC[WebRTC Peer]
		WS[WebSocket Client]
	end

	subgraph Server[Spring Boot Backend]
		WSS[WebSocket (STOMP/SockJS)]
		REST[REST API]
	end

	Client -- Playback Events --> WS
	WS -- Sync Broadcasts --> Client
	Client -- Room Create/Join --> REST
	RTC <-- SDP/ICE via WSS --> Server
	RTC <== Peer Connections ==> RTC
	YT --- Loads/Controls --- Client
```

---

## 5. Technology Stack
- Frontend: React, WebRTC, YouTube IFrame Player API, STOMP client
- Backend: Spring Boot, WebSocket (STOMP/SockJS), REST API, JWT (optional)
- Database: PostgreSQL/MySQL (optional for persistent rooms)
- Deployment: Frontend (Vercel/Netlify), Backend (Heroku/Render/AWS)

---

## 6. Getting Started

This repository currently contains the React frontend under `frontend/`. The Spring Boot backend will be added in a separate module/folder.

### 6.1 Prerequisites
- Node.js 20.11.1 (supported in this project by pinning Vite 4.x)
	- Note: Vite 5+/7+ require newer Node; if you upgrade Node to 20.19+ or 22.12+, you can also upgrade Vite.
- npm 10+
- (Backend, later) Java 17+ and Maven/Gradle

### 6.2 Frontend (React + Vite)
Windows PowerShell commands:

```powershell
cd frontend
npm install
npm run dev
```

The dev server will print a local URL (e.g., http://localhost:5173). Open it in your browser.

### 6.3 Backend (Spring Boot)
TBD – Will expose:
- REST: POST /rooms (create), POST /rooms/{id}/join (join)
- WebSocket/STOMP topics for room events and sync
- Signaling endpoints for WebRTC (SDP/ICE)

---

## 7. Configuration
- YouTube IFrame Player API: no API key required to embed/play by ID
- If adding search/metadata features, set a YouTube Data API key via environment variables (e.g., `YOUTUBE_API_KEY`)
- For auth (optional): configure JWT issuer/secret or Firebase project

---

## 8. Troubleshooting
- Error: `Vite requires Node.js version 20.19+ or 22.12+` / `crypto.hash is not a function`
	- Cause: Newer Vite on older Node. This project pins Vite 4.x to support Node 20.11.1.
	- Fix: Keep Node 20.11.1 and use the pinned Vite; or upgrade Node to ≥ 20.19 and update Vite.
- Dev script not found
	- Ensure you run commands from the `frontend/` directory.

---

## 9. Roadmap / Future Enhancements
- Support large rooms via an SFU (mediasoup/Jitsi)
- Screen sharing
- Playlist/queue for videos
- Emoji reactions and polls
- Mobile app (React Native)

---

## 11. License
TBD
